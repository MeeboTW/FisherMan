<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>é®®é­šå¾Œå°ç®¡ç†ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      margin-bottom: 10px;
    }
    .admin-panel {
      background: #fff3e0;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #ffcc80;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      background: #1976d2;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background: gray;
    }
  </style>
</head>

<body>
  <div id="app">
    <h1>ğŸ“‹ è¨‚å–®ç®¡ç†ç³»çµ±</h1>
    <p><a href="index.html">â† è¿”å›å•†åº—å‰å°</a></p>

    <div class="admin-panel">
      <button @click="fetchOrders">ğŸ”„ é‡æ–°æ•´ç†è¨‚å–®</button>
      
      <div v-if="orders.length === 0" style="margin-top:10px;">
        <p>ç›®å‰æ²’æœ‰è¨‚å–®</p>
      </div>

      <table v-else>
        <thead>
          <tr>
            <th>è¨‚å–®ç·¨è™Ÿ</th>
            <th>å®¢æˆ¶è³‡æ–™</th>
            <th>è³¼è²·å…§å®¹</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="order in orders" :key="order.orderId">
            <td>{{ order.orderId }}</td>
            <td>
              <!-- é˜²å‘†ï¼šcustomer å¯èƒ½æ˜¯ undefined -->
              {{ order.data.customer ? order.data.customer.name : 'ç„¡å§“å' }}<br>
              <small>{{ order.data.customer ? order.data.customer.phone : 'ç„¡é›»è©±' }}</small>
            </td>
            <td>
              <!-- é˜²å‘†ï¼šcart å¯èƒ½æ˜¯ undefined -->
              <div v-if="order.data.cart">
                <div v-for="item in order.data.cart">
                  {{ item.Name }} x {{ item.quantity }}
                </div>
              </div>
              <div v-else style="color:red;">(è³‡æ–™ç¼ºæ)</div>
            </td>
            <td>
              <button style="background:#d32f2f; padding:4px 8px;" @click="deleteOrder(order.orderId)">
                åˆªé™¤
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    new Vue({
      el: "#app",
      data() {
        return {
          apiUrl: "https://meebo-fish-hc300.dcwchris.workers.dev",
          orders: [] // è¨‚å–®åˆ—è¡¨
        };
      },

      methods: {
        // è®€å–è¨‚å–®
        fetchOrders() {
          console.log("Vue: é–‹å§‹è¼‰å…¥è¨‚å–®åˆ—è¡¨...");
          fetch(this.apiUrl + "/orders")
          .then(r => r.json())
          .then(data => {
            console.log("Vue: æ”¶åˆ°è¨‚å–®è³‡æ–™", data);
            this.orders = data.orders || [];
          })
          .catch(err => console.error("è®€å–è¨‚å–®å¤±æ•—", err));
        },

        // åˆªé™¤è¨‚å–®
        deleteOrder(id) {
          if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®å—ï¼Ÿ")) return;

          fetch(this.apiUrl + "/orders/delete/" + id, {
            method: "DELETE"
          })
          .then(r => r.json())
          .then(res => {
            alert("è¨‚å–®å·²åˆªé™¤");
            this.fetchOrders(); // é‡æ–°æ•´ç†
          })
          .catch(err => alert("åˆªé™¤å¤±æ•—"));
        }
      },

      mounted() {
        this.fetchOrders();
      }
    });
  </script>

</body>
</html>

